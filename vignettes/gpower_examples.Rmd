---
title: "G*Power examples evaluated with Spower"
author: Phil Chalmers
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2:
    base_format: rmarkdown::html_vignette
    number_sections: false
    toc: true
vignette: >
  %\VignetteIndexEntry{G*Power examples evaluated with Spower}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r nomessages, echo = FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE
)
options(digits=4)
par(mar=c(5,4,1,1)+.1)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(Spower)
set.seed(1234)
```

Estimate sample size ($n$) per group in independent samples $t$-test, one-tailed, medium effect size ($d=0.5$), $\alpha=0.05$, 95% power ($1-\beta = 0.95$), equal sample sizes ($\frac{n_2}{n_1}=1$).

```{r}
(out <- Spower(p_t.test, n = NA, d = .5, two.tailed=FALSE, 
			   power = .95, interval=c(10,500), verbose=FALSE))
```

G\*power estimate is 88 per group, `Spower` estimate is `r out$n`.

# Correlation

Power associated with $\rho = .1$ with 100 pairs of observations.

```{r}
Spower(p_r, n = 100, r = .1, verbose=FALSE)
```

Sample size estimate to reject $H_0:\, \rho_0=0$ in correlation analysis with $1-\beta=.95$ probability when $\rho=.3$.

```{r}
(out <- Spower(p_r, n = NA, r = .3,
			   power = .95, interval=c(50,1000), verbose=FALSE))
```

```{r}
pwr::pwr.r.test(r=.3, power=.95)
```

Sample size estimate to reject $H_0:\, \rho_0=.60$ in correlation analysis with $1-\beta=.95$ probability when $\rho=.65$.

```{r}
(out <- Spower(p_r, n = NA, r = .65, rho = .60, 
	   power = .95, interval=c(1000,4000), verbose=FALSE))
```

G\*power estimates $n$ to be 1928, though `Spower` returns the much larger `r out$n`.

# Proportions

One sample test

```{r}
pi <- .65
g <- .15
p <- pi + g

Spower(p_prop.test, n=20, prop=p, pi=pi, 
	   two.tailed=FALSE, interval=c(5,50), verbose=FALSE)

```

G\*power gives the estimate $1-\beta=.4112$. Fisher's exact test is also supported by using the argument `exact = TRUE`.

## Two dependent proportions test

```{r}
P <- matrix(c(.54, .32, .08, .06), 2, 2)
colnames(P) <- c('Standard (Yes)', 'Standard (No)')
rownames(P) <- c('Treatment (Yes)', 'Treatment (No)')
P
```

```{r}
# TODO
# Spower(p_prop.test, prop=P, n=50, verbose=FALSE)
```

# McNemar test

```{r}
obrien2002 <- matrix(c(.54, .32, .08, .06), 2, 2,
					 dimnames = list('Treatment' = c('Yes', 'No'),
					 				'Standard' = c('Yes', 'No')))
obrien2002

Spower(p_mcnemar.test, n=50, prop=obrien2002, 
	   two.tailed=FALSE, verbose=FALSE)
```

G\*Power gives .839 ($\alpha = .032$). Slightly more power can be achieved when not using the continuity correction (though in general this is not recommended practice).

```{r}
Spower(p_mcnemar.test, n=50, prop=obrien2002, 
	   two.tailed=FALSE, correct=FALSE, verbose=FALSE)
```

# Variance test

```{r}
# solve n for variance ratio of 1/1.5 = 2/3, one.tailed, 80% power
Spower(p_var.test, n=NA, sds=sqrt(1), sigma=sqrt(1.5), 
	   two.tailed=FALSE, power=.80, interval=c(10, 200), verbose=FALSE)
```

G\*power gives sample size of 81.

## Two-sample variance test

For a two-sample equality of variance test with equal sample sizes,

```{r}
# solve n for variance ratio of 1/1.5 = 2/3, one.tailed, 80% power
Spower(p_var.test, n=NA, sds=sqrt(c(1, 1.5)), 
	   two.tailed=TRUE, power=.80, interval=c(50, 300), verbose=FALSE)
```

G\*Power gives estimate of 193 per group.
